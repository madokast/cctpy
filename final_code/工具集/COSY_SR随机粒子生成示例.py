"""
CCT 建模优化代码
工具集

作者：赵润晓
日期：2021年6月7日
"""

import os
import sys
curPath = os.path.abspath(os.path.dirname(__file__))
rootPath = os.path.split(curPath)[0]
PathProject = os.path.split(rootPath)[0]
sys.path.append(rootPath)
sys.path.append(PathProject)

from cctpy import *
from cosy_utils import *

"""
使用方法
1. 使用 cctpy 中的 ParticleFactory.distributed_particles() 生成随机的相空间粒子
2. 使用 cosy_utils 的 SRConvertor.to_cosy_sr() 将相空间粒子输出为 COSY 的 SR 格式

两个方法的详细说明，见代码注释

以下给出3个使用示例
"""

# 束流参数为 x=y=3.5mm，xp,yp=7.5mr，dp=8%。生成粒子数目20

# 1. 生成x/xp相椭圆圆周上，动量分散为0的粒子，同时 y=3.5mm，yp=7.5mr。在 COSY 绘图为蓝色
ps = ParticleFactory.distributed_particles(
    3.5*MM, 7.5*MRAD, 3.5*MM, 7.5*MRAD, 0.0, number=20,
    distribution_area=ParticleFactory.DISTRIBUTION_AREA_EDGE,
    x_distributed=True, xp_distributed=True
)
cosy_code = SR.to_cosy_sr(ps,color=SR.COLOR_BLUE)
print('-----------生成x/xp相椭圆圆周上，动量分散为0的粒子，同时 y=3.5mm，yp=7.5mr。在 COSY 绘图为蓝色---------')
print(cosy_code)
print('\n\n')



# 2. 生成y/yp相椭圆内部，动量分散均为0.05的粒子。在 COSY 绘图为红色
ps = ParticleFactory.distributed_particles(
    0, 0, 3.5*MM, 7.5*MRAD, 0.05, number=20,
    distribution_area=ParticleFactory.DISTRIBUTION_AREA_FULL,
    y_distributed=True, yp_distributed=True
)
cosy_code = SR.to_cosy_sr(ps,color=SR.COLOR_RED)
print('-----------生成y/yp相椭圆内部，动量分散均为0.05的粒子，同时 x=xp=0。在 COSY 绘图为红色---------')
print(cosy_code)
print('\n\n')



# 3. 生成 x/xp/delta 三维相椭球球面的粒子。在 COSY 绘图为黑色
ps = ParticleFactory.distributed_particles(
    3.5*MM, 7.5*MRAD, 3.5*MM, 7.5*MRAD, 0.08, number=20,
    distribution_area=ParticleFactory.DISTRIBUTION_AREA_EDGE,
    x_distributed=True, xp_distributed=True, delta_distributed=True
)
cosy_code = SR.to_cosy_sr(ps,color=SR.COLOR_BLACK)
print('-----------生成 x/xp/delta 三维相椭球球面的粒子。在 COSY 绘图为蓝色---------')
print(cosy_code)
print('\n\n')


"""
-----------生成x/xp相椭圆圆周上，动量分散为0的粒子，同时 y=3.5mm，yp=7.5mr。在 COSY 绘图为蓝色---------
SR 0.0023550606259619164 -0.005548175147335163 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.0034100859884606347 0.0016890738256935133 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.0031871608961141122 0.003099378542096639 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.002957350669606211 0.004011252867591861 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.0015270352551892152 0.006748524780770605 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.0029903904242553933 -0.003897152675593443 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.003016042580386047 0.003805298694307748 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.0013243294547146277 -0.006942378123480179 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.003281229514305085 0.002610007806509451 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.002751790699456844 -0.004634543739373486 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.003325095175795574 -0.002341253659368116 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.0030351772734188826 0.0037347847976615333 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.0006761702774500693 0.007358708009764928 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.0012646001705297458 0.006993330557383171 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.00144044204749999 -0.006835387377245963 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.0027370325963500396 -0.004674500578947415 0.0035 0.0075 0 0.0 0 0 2 ;
SR -0.003481569914248999 -0.0007686585153017575 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.0028955828270263665 -0.004213099156594941 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.00283481494525751 -0.004398771746198483 0.0035 0.0075 0 0.0 0 0 2 ;
SR 0.0034998838891147706 6.1090700525721e-05 0.0035 0.0075 0 0.0 0 0 2 ;



-----------生成y/yp相椭圆内部，动量分散均为0.05的粒子，同时 x=xp=0。在 COSY 绘图为红色---------
SR 0 0 -0.001074488834157417 0.0008392302962304272 0 0.05 0 0 2 ;
SR 0 0 -0.0033644754694775484 -0.0005426457962504376 0 0.05 0 0 2 ;
SR 0 0 -0.0020515526529917153 -0.003633773527202299 0 0.05 0 0 2 ;
SR 0 0 0.0015434766400787277 0.0022259801542874828 0 0.05 0 0 2 ;
SR 0 0 0.001730675913594148 -0.005354264052576244 0 0.05 0 0 2 ;
SR 0 0 -0.0026337666197850454 -0.0015905145476216524 0 0.05 0 0 2 ;
SR 0 0 0.000654673273972247 0.006019386210095824 0 0.05 0 0 2 ;
SR 0 0 3.0068325798071963e-05 -0.0057853179218149845 0 0.05 0 0 2 ;
SR 0 0 0.0027932337995872527 0.003969212716056585 0 0.05 0 0 2 ;
SR 0 0 0.0014264929785649514 -0.0033601635227063905 0 0.05 0 0 2 ;
SR 0 0 0.000229440523705585 -0.0061097531824896465 0 0.05 0 0 2 ;
SR 0 0 0.0018724194426551163 -1.7014246053604666e-05 0 0.05 0 0 2 ;
SR 0 0 0.001061818224733484 -0.001316571851246679 0 0.05 0 0 2 ;
SR 0 0 -0.0013612686468201449 0.000871218889194841 0 0.05 0 0 2 ;
SR 0 0 -0.00037577553940962944 0.005224717294801808 0 0.05 0 0 2 ;
SR 0 0 -0.0003259520742932972 -0.0050392449157235075 0 0.05 0 0 2 ;
SR 0 0 0.0015882956610906618 -0.00640095664402642 0 0.05 0 0 2 ;
SR 0 0 -0.0013087652046610198 -0.003918242224898925 0 0.05 0 0 2 ;
SR 0 0 0.00014303469000477662 -0.002753896713788809 0 0.05 0 0 2 ;
SR 0 0 0.0008432517980714546 0.0056613113874706515 0 0.05 0 0 2 ;



-----------生成 x/xp/delta 三维相椭球球面的粒子。在 COSY 绘图为蓝色---------
SR 0.0012218720174092 0.006859550346111633 0.0035 0.0075 0 0.008155650329288916 0 0 2 ;
SR 0.0032506566563785147 -0.0019109640599160942 0.0035 0.0075 0 -0.01939559901905243 0 0 2 ;
SR 0.001821751665684061 -0.006353203072004507 0.0035 0.0075 0 -0.004538078316054552 0 0 2 ;
SR 0.0033766966359786927 -0.0017992030112939836 0.0035 0.0075 0 -0.007866922347763908 0 0 2 ;
SR 0.0022351277114086424 0.005732806131285611 0.0035 0.0075 0 -0.004042528377489441 0 0 2 ;
SR -0.0023935770579708963 -0.001318601514692437 0.0035 0.0075 0 -0.05374273164355121 0 0 2 ;
SR 0.0018911060897048631 0.0033087494127956012 0.0035 0.0075 0 0.04397693960014292 0 0 2 ;
SR 0.00117941980393713 0.00697314860022154 0.0035 0.0075 0 0.0058573743898320384 0 0 2 ;
SR -0.003483936845355006 0.00048343618703746354 0.0035 0.0075 0 0.0056168107437387675 0 0 2 ;
SR -0.0031574410621684214 0.003235550069465789 0.0035 0.0075 0 -0.00046729617049685906 0 0 2 ;
SR 0.0031582636885045864 0.0030766442723390943 0.0035 0.0075 0 -0.008346602942781816 0 0 2 ;
SR -0.003476599809852804 -0.00031027826694557685 0.0035 0.0075 0 0.00859557323928406 0 0 2 ;
SR 0.0034939434452530027 0.0004104440232204582 0.0035 0.0075 0 0.0017121604543312624 0 0 2 ;
SR -0.0034113041616686346 6.847845873178004e-05 0.0035 0.0075 0 -0.017878311529790445 0 0 2 ;
SR 0.0024257980200178084 0.00412641799299576 0.0035 0.0075 0 -0.02579019570223865 0 0 2 ;
SR 0.0013451311341018553 -0.006888002439034991 0.0035 0.0075 0 0.0037462932320371264 0 0 2 ;
SR 0.0003841357518809243 0.007454205240768336 0.0035 0.0075 0 0.0004259202493676665 0 0 2 ;
SR 0.0016775368441824521 -0.006581239228895239 0.0035 0.0075 0 0.0006791369211382665 0 0 2 ;
SR 0.003483552692512566 -0.0002558161188133894 0.0035 0.0075 0 0.007234933007656942 0 0 2 ;
SR 0.003319031711937505 -0.002376193321615713 0.0035 0.0075 0 -0.0012985138341923188 0 0 2 ;
"""
